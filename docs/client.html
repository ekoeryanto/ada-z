<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Press-32 Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
            <div class="max-w-4xl mx-auto p-6" x-data="clientApp()">
                <header class="flex items-center justify-between mb-4">
                    <h1 class="text-2xl font-semibold">Press-32</h1>
                            <nav class="space-x-2">
                                <a href="#/readings" @click.prevent="route='/readings'; location.hash='/readings'" class="text-sm text-blue-600">Readings</a>
                                <a href="#/config" @click.prevent="route='/config'; location.hash='/config'" class="text-sm text-blue-600">Config</a>
                                <a href="#/calibration" @click.prevent="route='/calibration'; location.hash='/calibration'" class="text-sm text-blue-600">Calibration</a>
                                <a href="#/utils" @click.prevent="route='/utils'; location.hash='/utils'" class="text-sm text-blue-600">Utilities</a>
                            </nav>
                </header>

            <section class="bg-white rounded shadow p-4 mb-4" x-show="route === '/readings'">
                <h2 class="font-medium mb-2">Device Configuration</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
                      <input id="deviceIp" x-model="hostInput" class="col-span-2 border rounded px-3 py-2" placeholder="Device IP or host (e.g. 192.168.1.50)" />
                    <div class="flex gap-2">
                        <button id="saveBtn" @click="saveConfig()" class="bg-blue-600 text-white px-3 py-2 rounded">Save</button>
                        <button id="testBtn" @click="saveConfig(); testFetch()" class="bg-green-600 text-white px-3 py-2 rounded">Test</button>
                    </div>
                </div>
            <p id="currentConfig" class="text-sm text-gray-600 mt-2">No device configured.</p>
                    </section>

                    <section class="bg-white rounded shadow p-4 mb-4" x-show="route === '/config'" style="display:none">
                        <h2 class="font-medium mb-2">Device Configuration</h2>
                        <div id="configView">Loading...</div>
                    </section>

                    <section class="bg-white rounded shadow p-4 mb-4" x-show="route === '/calibration'" style="display:none">
                        <h2 class="font-medium mb-2">Calibration</h2>
                        <div id="calView">Loading...</div>
                    </section>

                    <section class="bg-white rounded shadow p-4 mb-4" x-show="route === '/utils'" style="display:none">
                        <h2 class="font-medium mb-2">Utilities</h2>
                        <div id="utilsView">Loading...</div>
                    </section>

            <section class="bg-white rounded shadow p-4 mb-4">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="font-medium">Sensor Readings</h2>
                    <div class="flex items-center gap-2">
                        <label class="text-sm text-gray-600">Auto-refresh</label>
                        <select id="autoRefresh" x-model="autoInterval" @change="onAutoChange" class="border rounded px-2 py-1">
                            <option value="0">Off</option>
                            <option value="5">5s</option>
                            <option value="10">10s</option>
                            <option value="30">30s</option>
                        </select>
                        <button id="refreshBtn" @click="testFetch()" class="bg-indigo-600 text-white px-3 py-1 rounded">Refresh</button>
                    </div>
                </div>

                    <div id="status" class="text-sm text-gray-600 mb-2" x-text="statusText">Idle</div>

                        <div id="readingsView" class="space-y-3">
                            <div class="text-sm text-gray-700"><strong>Timestamp:</strong> <span id="ts">-</span></div>
                            <div class="text-sm text-gray-700"><strong>RTU:</strong> <span id="rtu">-</span></div>
                            <div class="overflow-auto">
                                <table id="tagsTable" class="w-full text-sm table-auto border-collapse">
                                    <thead>
                                        <tr class="bg-gray-100 text-left"><th class="p-2">ID</th><th class="p-2">Port</th><th class="p-2">Source</th><th class="p-2">Scaled</th><th class="p-2">Converted</th></tr>
                                    </thead>
                                    <tbody id="tagsBody"></tbody>
                                </table>
                            </div>
                        </div>

                    <pre id="output" class="bg-gray-50 p-3 rounded text-sm overflow-auto max-h-36 hidden" x-text="rawJson"></pre>
            </section>

            <footer class="text-xs text-gray-500 mt-4">Client built with Tailwind â€” stores device IP in localStorage.</footer>
        </div>

                <script src="https://unpkg.com/@shaun/alpinejs-router@1.x.x/dist/cdn.min.js" defer></script>
                <script type="module" src="./client.js"></script>
                <script>
                    // Alpine root component factory accessible to client.js
                    function clientApp() {
                        return {
                            hostInput: '',
                            statusText: 'Idle',
                            autoInterval: '0',
                            rawJson: '',
                            onAutoChange() { /* placeholder, implemented in module */ },
                            saveConfig() { /* placeholder */ },
                            testFetch() { /* placeholder */ }
                        }
                    }
                    window.clientApp = clientApp;
                </script>
</body>
</html>